test

### Описание возможных состояний девайса

| Название состояния  | Описание состояния                                                                                                                                                         | Код состояния |
| ------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- |
| Подключено          | Состояние, когда до аппаратного устройства установлено стабильное соединение                                                                                               | П-1           |
| Отключено           | Состояние, когда: либо не было попытки установки соединения до аппаратного устройства, либо последнее соединение было прервано самим пользователем (а не внешней причиной) | О-1           |
| Соединение потеряно | Состояние, когда подключение не установлено и было потеряно по внешним причинам после последней успешной установки                                                         | О-2           |

### Описание параметров Девайса (EPSS13)

| Имя парамтра                         | Описание параметра                                                                                                                                                                                                                                                                                                                    | Соответствие с регистровой картой                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Состояния, в котором доступно чтение | Состояния, в котором доступна запись | Код параметра |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------ | ------------------------------------ | ------------- |
| Период внутреннего старта            | Период стартового импульса внутреннего генератор. Измеряется в нс.<br><br>В соответствие с этим периодом вырабатываются старты внутреннего генератора.<br><br>Если устройство работает в "Режиме работы от внутреннего генератора", то сигналы на каналах таймера вырабатываются в соответствие с периодом этого стартового импульса. | Находится в двух Holding регистрах. Кодируется 32 битами. Один холдинг регистр отвечает за младшие 16бит, другой за старший. Например, чтобы хранить число 1 (0000 0000 0000 0000 0000 0000 0000 0001), в двух последовательных регистрах будет записано [1, 0] соответственно.<br>Если в двух последовательных регистрах записано [0, 1], то это означает число 65536 (0000 0000 0000 0001 0000 0000 0000 0000)<br><br>Номер регистров: 2, 3<br><br><br>Для того, чтобы перевести число, хранимое в регистрах необходимо домножить уже получившееся слиянием 32битное число на 25 и после этого прибавить 100 нс.<br><br>1 дискрет (единица) в значениях регистра = 25 нс. (поэтому и идет домножение на 25).<br><br>Если в регистре лежит [0, 0] (т.е. 0), то это означает 100 нс (сдвиг).<br><br>Пример: в регистрах лежат значения [4, 0]. "Склеиваем" в обратном порядке, получаем 0000 0000 0000 0000 0000 0000 0000 0100 (или 0x00000004). В десятичной системе -- это 4.<br><br>Мы получили значение из регистровой карты в ДИСКРЕТАХ. Теперь надо домножить его на 25 нс, чтобы получить значения в нс. `4 * 25 = 100` .<br><br>Далее, необходимо добавить сдвиг 100 нс. `100 + 100 = 200` .<br><br>***Итого: если в регистрах 2,3 лежит [4, 0], то это означает, что период внутреннего старта равен 200 нс*** | П-1                                  | П-1                                  | ВС-1          |
| Длительность внутреннего старта      | Длительность стартового импульса внутреннего генератор. Измеряется в нс.                                                                                                                                                                                                                                                              | Находится в двух Holding регистрах.<br><br>Номера регистров: 4,5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | П-1                                  | П-1                                  | ВС-2          |
| Статус работы внутреннего старта     | Указывает на то, включен ли формирователь внутреннего старта или нет.<br><br>1 -- если включен,                                                                                                                                                                                                                                       | Находится в 0 бите 6 Holding Register.<br><br>Т.е. надо взять значение из holding регистра 6. Далее заменить его 0 (нулевой) бит на нужное значение.<br><br>Например. Если нам надо прочитать статус работу внутреннего старта, а в 6 регистре лежит 0000 0101 1110 110**1**  , то статус будет: 1, т.е. формирователь включен.<br>А если бы нам надо было бы в этом примере выключить формирователь, то мы должны были бы записать в 6 holding регистр число: 0000 0101 1110 110**0**. <br><br>Обратите внимание, что меняется только один бит. Остальное число должно оставаться таким же, каким и было до записи.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | П-1                                  | П-1                                  | ВС-3          |
| Инвертированность внутреннего старта | Указывает на то, используется ли инверсия импульса внутреннего старта.<br><br>1 -- если используется,<br>0 -- если не используется.                                                                                                                                                                                                   | Аналогично, как и "Статус работы внутреннего старта", инвертированность лежит в 6 holding регистре в 1 (первом) бите.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | П-1                                  | П-1                                  | ВС-4          |
| Задержка импульса на канале          | Служит для установки задержки импульса на канале                                                                                                                                                                                                                                                                                      | Хранится в двух регистрах MSB и LSB аналогично.<br><br>Хранит значение в ДИСКРЕТАХ.<br><br>Склейка MSB и LSB регистра делается аналогично с периодом внутреннего старта.<br><br>Сдвиг задержки 100 нс<br>Округление задержки требуется до числа кратного 25                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | П-1                                  | П-1                                  | ВС-5          |
| Длительность импульса на канале      | Служит для установки длительности импульса на канале                                                                                                                                                                                                                                                                                  | Хранится в двух регистрах MSB и LSB аналогично.<br><br>Хранит значение в ДИСКРЕТАХ.<br><br>Склейка MSB и LSB регистра делается аналогично с периодом внутреннего старта.<br><br>Сдвиг длительности 100 нс<br>Округление задержки требуется до числа кратного 25                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | П-1                                  | П-1                                  | ВС-6          |
| Cтатус включенности канала           | Указывает на то, включен ли канал или нет<br><br>                                                                                                                                                                                                                                                                                     | Управляется 0 битом Holding регистра "Управление каналом <номер канала>" (см. регистровую карту)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | П-1                                  | П-1                                  | ВС-7          |
| Cтатус инверсии канала               | Указывает на то, инвертирован ли канал или нет                                                                                                                                                                                                                                                                                        | Управляется 1 битом Holding регистра "Управление каналом <номер канала>" (см. регистровую карту)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | П-1                                  | П-1                                  | ВС-8          |
| Режим работы канала                  | Канал может быть в двух режимах:<br><br>- **Запускающий импульс** (*в этом режиме канал просто пробрасывает импульс своего запуска. Включенность и инверсия ВЛИЯЮТ на импульс*)<br>- **Задержканный импульс** (*в этом режиме к канал вырабатывает свои импульсы с задержкой и длительностью*)                                        | Управляется 7 битом в Holding регистре "Управление каналом <номер канала>" (см. регистровую карту)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | П-1                                  | П-1                                  | ВС-8          |
| Источник запуска канала              | На канал выдается преобразованный импульс. Источник этого импульса указывается в этом параметре. Всего доступно 19 вариантов источников.                                                                                                                                                                                              | Управляется 5 битами (со 2 по 6 включительно) в Holding регистре "Управления Каналом <номер канала>" (см. регистровую карту)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | П-1                                  | П-1                                  | ВС-9          |
| Амплитуда канала                     | Влияет на амплитуду импульса, который выдается на канале.                                                                                                                                                                                                                                                                             | Устанавливается в Одном из Holding регистров (с 130 по 153, в зависимости от номера канала; см. регистровую карту) <br><br>Переводится из дискретов в В следующим образом:<br><br>*0 - 0В  <br>65535 - 12В  <br>Коэфф. пересчёта 12/65535 = 0.000183108263В на один отсчёт*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | П-1                                  | П-1                                  | ВС-10         |
| Выбранный SFP модуль                 | Выбор SFP модуля, статусы которого будут отображаться в параметрах (ВС-11, ВС-12, ВС-13, ВС-14, ВС-15)                                                                                                                                                                                                                                | Управляется Holding регистром 9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | П-1                                  | П-1                                  | ВС-10         |
| Температура SFP модуля               | Мониторинг SFP модуля                                                                                                                                                                                                                                                                                                                 | Хранится в Input регистре 5<br><br>*Пересчет из дискретов:<br>умножить на 1/256ºC (если t<128ºC); умножить на 1/256ºC и вычесть 256 (если t>=128ºC)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | П-1                                  | П-1                                  | ВС-11         |
| Напряжение питания SFP модуля        | Мониторинг SFP модуля                                                                                                                                                                                                                                                                                                                 | Хранится в Input регистре 6<br><br>*Пересчет из дискретов:<br>умножить на 0,1 мВ*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | П-1                                  | П-1                                  | ВС-12         |
| TX ток смещения                      | Мониторинг SFP модуля                                                                                                                                                                                                                                                                                                                 | Хранится в Input регистре 7<br><br>*Пересчет из дискретов: умножить на 2 мкА*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | П-1                                  | П-1                                  | ВС-13         |
| TX оптическая мощность               | Мониторинг SFP модуля                                                                                                                                                                                                                                                                                                                 | Хранится в Input регистре 8<br><br>*Пересчет из дискретов:<br>умножить на 0,1 мкВт*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | П-1                                  | П-1                                  | ВС-14         |
| RX принимаемая мощность сигнала      | Мониторинг SFP модуля                                                                                                                                                                                                                                                                                                                 | Хранится в Input регистре 9<br><br>*Пересчет из дискретов:<br>умножить на 0,1 мкВт*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | П-1                                  | П-1                                  | ВС-15         |
| RX статусы SFP модулей               | Мониторинг SFP модуля                                                                                                                                                                                                                                                                                                                 | Находится в Input регистре 3<br><br>*1 указывает на наличие сигнала на приёмнике SFP модуля  <br>00 - сигналы на приёмниках отсутствуют  <br>01 - сигнал на приёмнике SYNC модуля присутствует  <br>10 - сигнал на приёмнике модуля RF присутствует  <br>11 - все сигналы на приёмниках присутствуют*<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | П-1                                  | П-1                                  | ВС-16         |
| TX статусы SFP модулей               | Мониторинг SFP модуля                                                                                                                                                                                                                                                                                                                 | Находится в Input регистре 4<br><br>*1 указывает на наличие сигнала на передатчике SFP модуля  <br>00 - сигналы на передатчиках отсутствуют  <br>01 - сигнал на передатчике RF модуля присутствует  <br>10 - сигнал на передатчике SYNC модуля присутствует  <br>11 - все сигналы на приёмниках присутствуют*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | П-1                                  | П-1                                  | ВС-17         |
| Статусы системы ФАПЧ                 | Мониторинг SFP модуля                                                                                                                                                                                                                                                                                                                 | Находится в Input регистре 10<br><br>*x1 - есть захват частоты системой ФАПЧ десериализатора (0 - захват отсутствует)  <br>1х - есть захват частоты системой ФАПЧ схемой очистки тактового сигнала восходящего потока  <br>(0 - захват отсутствует)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | П-1                                  | П-1                                  | ВС-18         |





### Описание вариантов использования девайса EPSS13

| Вариант использования                                                       | Описание варианта использования                                                                                                                                                                                                                                                                                                                                 | Название классов UseCase                                                                                                                                                                                                                                                                                                                                                                                                     | Формат запроса        | Формат ответа                                        | Состояние, в котором доступен вариант | Ссылка на Pull Request и Issue с добавлением варианта использования |
| --------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | ---------------------------------------------------- | ------------------------------------- | ------------------------------------------------------------------- |
| Получить период внутреннего старта                                          | Получает значение периода внутреннего генератора (ВС-1) в нс. <br><br>Минимальное значение 100 нс, максимальное значение: 2 мс. Шаг 100 нс (т.е. не может быть 130 нс). Округление значение идет в соответствие с математическими правилами.<br><br><br>Вариант можно использовать только в том случае, если установлено подключение к аппаратному девайсу      | - **GetInnerStartPeroidUseCase**: класс юзкейса<br>- GetInnerStartPeriodUseCaseRequest: класс запроса юзкейса<br>- GetInnerStartPeriodUseCaseResponse:<br>- класс запроса юзкейса<br><br>- **GetInnerStartPeriod**: метод сущности девайса<br>- **GetInnerStartPeriodRequest**: входной параметр метода сущности девайса<br>- **GetInnerStartPeriodResponse**:<br>- выходной (возвращаемый) параметр метода сущности девайса | <br>                  | 1. ErrorCode (код ошибки)<br>2. uint64_t (результат) | П-1                                   | *НЕОБХОДИМО ДОПИСАТЬ*                                               |
| Установить период внутреннего старта                                        | Устанавливает значение периода внутреннего генератора (ВС-1) в нс. <br><br>Минимальное значение 100 нс, максимальное значение: 2 мс. Шаг 100 нс (т.е. не может быть 130 нс). Округление значение идет в соответствие с математическими правилами.<br><br><br>Вариант можно использовать только в том случае, если установлено подключение к аппаратному девайсу | - **SetInnerStartPeroidUseCase**: класс юзкейса<br>- SetInnerStartPeriodUseCaseRequest: класс запроса юзкейса<br>- SetInnerStartPeriodUseCaseResponse:<br>- класс запроса юзкейса<br><br>- **SetInnerStartPeriod**: метод сущности девайса<br>- **SetInnerStartPeriodRequest**: входной параметр метода сущности девайса<br>- **SetInnerStartPeriodResponse**:<br>- выходной (возвращаемый) параметр метода сущности девайса | *НЕОБХОДИМО ДОПИСАТЬ* | *НЕОБХОДИМО ДОПИСАТЬ*                                | П-1                                   | *НЕОБХОДИМО ДОПИСАТЬ*                                               |
| Получить длительность внутреннего старта                                    | Получает значение периода внутреннего генератора (ВС-2) в нс. <br><br>Минимальное значение 100 нс, максимальное значение: 2 мс. Шаг 100 нс (т.е. не может быть 130 нс). Округление значение идет в соответствие с математическими правилами.<br><br>Вариант можно использовать только в том случае, если установлено подключение к аппаратному девайсу          |                                                                                                                                                                                                                                                                                                                                                                                                                              |                       |                                                      |                                       |                                                                     |
| Установить длительность внутреннего старта                                  | Устанавливает значение периода внутреннего генератора (ВС-2) в нс. <br><br>Минимальное значение 100 нс, максимальное значение: 2 мс. Шаг 100 нс (т.е. не может быть 130 нс). Округление значение идет в соответствие с математическими правилами.<br><br>Вариант можно использовать только в том случае, если установлено подключение к аппаратному девайсу     | *НЕОБХОДИМО ДОПИСАТЬ*                                                                                                                                                                                                                                                                                                                                                                                                        | *НЕОБХОДИМО ДОПИСАТЬ* | *НЕОБХОДИМО ДОПИСАТЬ*                                | П-1                                   | *НЕОБХОДИМО ДОПИСАТЬ*                                               |
| Получить статус внутреннего формирователя импульсов                         | Получает значение "Статуса работы внутреннего старта" (ВС-3)                                                                                                                                                                                                                                                                                                    | *НЕОБХОДИМО ДОПИСАТЬ*                                                                                                                                                                                                                                                                                                                                                                                                        | *НЕОБХОДИМО ДОПИСАТЬ* | *НЕОБХОДИМО ДОПИСАТЬ*                                | П-1                                   | *НЕОБХОДИМО ДОПИСАТЬ*                                               |
| Установить статус внутреннего формирователя импульсов                       | Устанавливает значение статуса работы внутреннего старта (ВС-3).<br><br>Т.е. включает или выключает внутренний формирователь импульсов                                                                                                                                                                                                                          | *НЕОБХОДИМО ДОПИСАТЬ*                                                                                                                                                                                                                                                                                                                                                                                                        | *НЕОБХОДИМО ДОПИСАТЬ* | *НЕОБХОДИМО ДОПИСАТЬ*                                | П-1                                   | *НЕОБХОДИМО ДОПИСАТЬ*                                               |
| Получить статус инвертированности <br>импульсов внутреннего формирователя   | Получает значение "Инвертированность внутреннего старта" (ВС-4)                                                                                                                                                                                                                                                                                                 | *НЕОБХОДИМО ДОПИСАТЬ*                                                                                                                                                                                                                                                                                                                                                                                                        | *НЕОБХОДИМО ДОПИСАТЬ* | *НЕОБХОДИМО ДОПИСАТЬ*                                | П-1                                   | *НЕОБХОДИМО ДОПИСАТЬ*                                               |
| Установить статус инвертированности <br>импульсов внутреннего формирователя | Устанавливает значение статуса инвертированности импульсов внутреннего формирователя (ВС-4).<br><br>Т.е. включает или выключает инверсию на внутреннем формирователе                                                                                                                                                                                            | *НЕОБХОДИМО ДОПИСАТЬ*                                                                                                                                                                                                                                                                                                                                                                                                        | *НЕОБХОДИМО ДОПИСАТЬ* | *НЕОБХОДИМО ДОПИСАТЬ*                                | П-1                                   | *НЕОБХОДИМО ДОПИСАТЬ*                                               |

### Регистровая карта девайса

Ссылка на регистровую карту https://docs.google.com/spreadsheets/d/1PD4ZAohv3VeYTXvfVCz3mIQ0roxGQvcG/edit#gid=1952321624

### Макет

Пример виджет для управления похожим девайсом. Различие будет в количестве каналов. **В вашем случае их будет 24!**

![[Pasted image 20240415135305.png]]

Размещаться каналы будут примерно так:
![[Pasted image 20240415135403.png]]

Также, еще одно отличие в том, что необходимо будет вести мониторинг не только SYNC модуля, но и модуля RF. Выглядеть это будет примерно так:
![[Pasted image 20240415135449.png]]


При нажатии на кнопку "SFP Parameters" должно появляться диалоговое окно:
![[Pasted image 20240415135603.png]]

